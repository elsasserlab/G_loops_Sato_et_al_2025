library(wigglescout)
plot_bw_loci_summary_heatmap('Undetermined_S0_L001.rpgc.bw','ChromHMM17.chr9.mm39lift.bed')
```{r width=9, height=6}
library(wigglescout)
plot_bw_loci_summary_heatmap('Undetermined_S0_L001.rpgc.bw','ChromHMM17.chr9.mm39lift.bed')
plot_bw_loci_summary_heatmap('Undetermined_S0_L001.rpgc.bw','ChromHMM17.chr9.mm39lift.bed')
bw_dir <- "./"
library("wigglescout")
library("ggpubr")
library("ggplot2")
library("DESeq2")
library("dplyr")
library("ggrastr")
clean <- function (fn) {
fn <- gsub(pattern = ".+/", "", x = fn)
fn <- gsub(pattern = ".mm9.+", "", x = fn)
fn <- gsub(pattern = ".mm39.+", "", x = fn)
fn <- gsub(pattern = "_S.+", "", x = fn)
fn <- gsub(pattern = "_combined.+", "", x = fn)
fn <- gsub(pattern = "G4 CnT ", "", x = fn)
fn <- gsub(pattern = "G4_CnT_", "", x = fn)
fn <- gsub(pattern = "_batch2", "", x = fn)
fn <- gsub(pattern = "-", " ", x = fn)
fn <- gsub(pattern = "_", " ", x = fn)
fn <- gsub(pattern = " HA ", " ", x = fn)
fn <- gsub(pattern = "D1D6", "FANCJ-/-", x = fn)
fn <- gsub(pattern = "P2D2", "DHX36-/-", x = fn)
fn <- gsub(pattern = "P3D4", "FANCJ-/-DHX36-/-", x = fn)
return(fn)
}
brca2 <- list.files(bw_dir,pattern="GSM.+.bw",full.names = T)
mypal <-c("green4","#505050")
pks <- bedscout::import_named_bed_into_list('G4_CnT_combined_peaks_DJ_nonDJ.mm9.bed')
plot_profile_BRCA2 <- plot_bw_profile(bwfiles = brca2[1],loci = pks, labels=c("DJ","nonDJ"),mode="center",show_error=T,colors = mypal, verbose=F) + coord_cartesian(ylim=c(0,2.5))
bw_dir <- "~/Downloads/BRCA2/"
library("wigglescout")
library("ggpubr")
library("ggplot2")
library("DESeq2")
library("dplyr")
library("ggrastr")
clean <- function (fn) {
fn <- gsub(pattern = ".+/", "", x = fn)
fn <- gsub(pattern = ".mm9.+", "", x = fn)
fn <- gsub(pattern = ".mm39.+", "", x = fn)
fn <- gsub(pattern = "_S.+", "", x = fn)
fn <- gsub(pattern = "_combined.+", "", x = fn)
fn <- gsub(pattern = "G4 CnT ", "", x = fn)
fn <- gsub(pattern = "G4_CnT_", "", x = fn)
fn <- gsub(pattern = "_batch2", "", x = fn)
fn <- gsub(pattern = "-", " ", x = fn)
fn <- gsub(pattern = "_", " ", x = fn)
fn <- gsub(pattern = " HA ", " ", x = fn)
fn <- gsub(pattern = "D1D6", "FANCJ-/-", x = fn)
fn <- gsub(pattern = "P2D2", "DHX36-/-", x = fn)
fn <- gsub(pattern = "P3D4", "FANCJ-/-DHX36-/-", x = fn)
return(fn)
}
brca2.bws <- list.files(bw_dir,pattern="ESC_.+.bw",full.names = T)
mypal <-c("green4","#505050")
brca2.peaks <- rtracklayer::import('../peaks/ESC_BRCA2_peaks.bed')
peak_universe <- rtracklayer::import("../peaks/G4_combined_min3rep.bed")
bedscout::plot_euler(list(brca2.peaks,peak_universe),names = c("BRCA2","G4"))
peak_DJs <- bedscout::import_named_bed_into_list('../peaks/G4_CnT_combined_peaks_DJ_nonDJ.bed')
p_venn_g4_brca2 <- bedscout::plot_euler(append(append(peak_DJs,peak_universe),brca2.peaks),names = c("DJ","nonDJ","G4","BRCA2"),shape = "ellipse")
ggsave(p_venn_g4_brca2,"venn_g4_brca2.pdf")
ggsave("plots/venn_g4_brca2.pdf",p_venn_g4_brca2)
peak_DJs <- bedscout::import_named_bed_into_list('../peaks/G4_CnT_combined_peaks_DJ_nonDJ.bed')
p_venn_g4_brca2 <- bedscout::plot_euler(append(append(peak_DJs,peak_universe),brca2.peaks),names = c("DJ","nonDJ","G4","BRCA2"),shape = "ellipse")
ggsave("plots/venn_g4_brca2.pdf",p_venn_g4_brca2)
p_venn_g4_brca2
bedscout::combinations_enrichment(append(append(peak_DJs,peak_universe),brca2.peaks),2.7G,ignore.strand = T)
bedscout::combinations_enrichment(append(append(peak_DJs,peak_universe),brca2.peaks),2700000000,ignore.strand = T)
bedscout::combinations_enrichment(append(append(peak_DJs,peak_universe),brca2.peaks),2700000000)
bedscout::combinations_enrichment(peak_DJs,brca2.peaks),2700000000)
bedscout::combinations_enrichment(peak_DJs,2700000000)
bedscout::combinations_enrichment(append(peak_DJs,peak_universe),2700000000)
bedscout::combinations_enrichment(append(peak_DJs,brca2.peaks),2700000000)
bedscout::combinations_enrichment(list(peak_DJs[[1]],peak_DJs[[2]],brca2.peaks),2700000000)
bedscout::combinations_enrichment(append(peak_DJs,brca2=brca2.peaks),2700000000)
pk_set <- append(append(peak_DJs,peak_universe),brca2.peaks)
names(pk_set)
names(pk_set) <- c("DJ","nonDJ","G4","Brca2")
bedscout::combinations_enrichment(pk_set,2700000000)
bedscout::plot_combinations_score(pk_set,jaccard_index)
bedscout::plot_combinations_score(pk_set,bedscout::jaccard_index())
bedscout::plot_combinations_score(pk_set,bedscout::jaccard_index
bedscout::plot_combinations_score(pk_set,bedscout::jaccard_index)
bedscout::plot_combinations_score(pk_set,bedscout::jaccard_index)
bedscout::plot_combinations_score(pk_set,bedscout::fc_enrichment
bedscout::plot_combinations_score(pk_set,bedscout::pairwise_enrichment
bedscout::plot_combinations_score(pk_set,bedscout::pairwise_enrichment)
bedscout::plot_combinations_score(pk_set,bedscout::fc_enrichment)
bedscout::plot_combinations_score(pk_set,bedscout::jaccard_index)
bedscout::plot_combinations_score(pk_set,bedscout::fc_enrichment)
bedscout::plot_combinations_score(pk_set,bedscout::fc_enrichment(genome_size = 2700000000))
bedscout::combinations_enrichment(pk_set,2700000000)
bedscout::plot_combinations_score(pk_set,bedscout::fc_enrichment(),genome_size=2700000000)
bedscout::plot_combinations_score(pk_set,bedscout::fc_enrichment,genome_size=2700000000)
bedscout::plot_combinations_score(pk_set,bedscout::fc_enrichment{genome_size=2700000000})
bedscout::combinations_enrichment(pk_set,2700000000)
bedscout::combinations_enrichment(pk_set,27000000000)
bedscout::combinations_enrichment(pk_set,270000000)
bedscout::combinations_enrichment(pk_set,2700000000)
if (!require("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("pqsfinder")
library(pqsfinder)
remove.packages("pqsfinder")
remove.packages("pqsfinder")
brca2.peaks <- rtracklayer::import('../peaks/ESC_BRCA2_peaks.bed')
peak_universe <- rtracklayer::import("../peaks/G4_combined_min3rep.bed")
bedscout::plot_euler(list(brca2.peaks,peak_universe),names = c("BRCA2","G4"))
ggsave("plots/venn_g4_brca2.pdf")
brca2.peaks <- rtracklayer::import('../peaks/ESC_BRCA2_peaks.bed')
peak_universe <- rtracklayer::import("../peaks/G4_combined_min3rep.bed")
bedscout::plot_euler(list(brca2.peaks,peak_universe),names = c("BRCA2","G4"))
ggsave("plots/Venn_G4_BRCA2.pdf")
peak_DJs <- bedscout::import_named_bed_into_list('../peaks/G4_CnT_combined_peaks_DJ_nonDJ.bed')
pk_set <- append(append(peak_DJs,peak_universe),brca2.peaks)
names(pk_set) <- c("DJ","nonDJ","G4","Brca2")
bedscout::plot_euler(append(append(peak_DJs,peak_universe),brca2.peaks),names = c("DJ","nonDJ","G4","BRCA2"),shape = "ellipse")
ggsave("plots/Venn_G4_Brca2_DJ.pdf")
peak_DJs <- bedscout::import_named_bed_into_list('../peaks/G4_CnT_combined_peaks_DJ_nonDJ.bed')
pk_set <- append(append(peak_DJs,peak_universe),brca2.peaks)
names(pk_set) <- c("DJ","nonDJ","G4","Brca2")
bedscout::plot_euler(append(append(peak_DJs,peak_universe),brca2.peaks),names = c("DJ","nonDJ","G4","BRCA2"),shape = "ellipse")
ggsave("plots/Venn_G4_Brca2_DJ.pdf")
ggsave("plots/Venn_G4_BRCA2_DJ.pdf")
brca2.peaks <- rtracklayer::import('../peaks/ESC_BRCA2_peaks.bed')
peak_universe <- rtracklayer::import("../peaks/G4_combined_min3rep.bed")
bedscout::plot_euler(list(brca2.peaks,peak_universe),names = c("BRCA2","G4"))
ggsave("plots/Venn_G4_BRCA2.pdf")
peak_DJs <- bedscout::import_named_bed_into_list('../peaks/G4_CnT_combined_peaks_DJ_nonDJ.bed')
pk_set <- append(append(peak_DJs,peak_universe),brca2.peaks)
names(pk_set) <- c("DJ","nonDJ","G4","Brca2")
bedscout::plot_euler(append(append(peak_DJs,peak_universe),brca2.peaks),names = c("DJ","nonDJ","G4","BRCA2"),shape = "ellipse")
ggsave("plots/Venn_G4_BRCA2_DJ.pdf")
bedscout::combinations_enrichment(pk_set,2700000000)
bedscout::plot_combinations_score(pk_set,bedscout::jaccard_index))
bedscout::plot_combinations_score(pk_set,bedscout::jaccard_index)
reticulate::repl_python()
reticulate::repl_python()
python3
reticulate::repl_python()
bedscout::combinations_enrichment(pk_set,2700000000)
reticulate::repl_python()
bw_dir <- "../bigwig"
library("wigglescout")
library("ggpubr")
library("ggplot2")
library("DESeq2")
library("dplyr")
library("ggrastr")
clean <- function (fn) {
fn <- gsub(pattern = ".+/", "", x = fn)
fn <- gsub(pattern = ".mm9.+", "", x = fn)
fn <- gsub(pattern = ".mm39.+", "", x = fn)
fn <- gsub(pattern = "_S.+", "", x = fn)
fn <- gsub(pattern = "_combined.+", "", x = fn)
fn <- gsub(pattern = "G4 CnT ", "", x = fn)
fn <- gsub(pattern = "_batch2", "", x = fn)
fn <- gsub(pattern = "-", " ", x = fn)
fn <- gsub(pattern = "_", " ", x = fn)
fn <- gsub(pattern = " HA ", " ", x = fn)
fn <- gsub(pattern = "D1D6", "FANCJ-/-", x = fn)
fn <- gsub(pattern = "P2D2", "DHX36-/-", x = fn)
fn <- gsub(pattern = "P3D4", "FANCJ-/-DHX36-/-", x = fn)
return(fn)
}
BWs <- paste0(bw_dir,list.files(bw_dir,pattern="G4_.+R..bw"))
mypal <-c("cornflowerblue","orange","red2","#505050")
mypal3 <-c("cornflowerblue","cornflowerblue","cornflowerblue","orange","orange","orange","red2","red","red2","black","black","black")
mypal2 <-c("cornflowerblue","cornflowerblue","orange","orange","red2","red","black","black")
bw_dir <- "/Volumes/DATA/DATA/Puck/bigwig/"
BWs <- paste0(bw_dir,list.files(bw_dir,pattern="G4_.+R..bw"))
mypal <-c("cornflowerblue","orange","red2","#505050")
mypal3 <-c("cornflowerblue","cornflowerblue","cornflowerblue","orange","orange","orange","red2","red","red2","black","black","black")
mypal2 <-c("cornflowerblue","cornflowerblue","orange","orange","red2","red","black","black")
clean <- function (fn) {
fn <- gsub(pattern = ".+/", "", x = fn)
fn <- gsub(pattern = ".mm9.+", "", x = fn)
fn <- gsub(pattern = ".mm39.+", "", x = fn)
fn <- gsub(pattern = "_S.+", "", x = fn)
fn <- gsub(pattern = "_combined.+", "", x = fn)
fn <- gsub(pattern = "G4 CnT ", "", x = fn)
fn <- gsub(pattern = "_batch2", "", x = fn)
fn <- gsub(pattern = "-", " ", x = fn)
fn <- gsub(pattern = "_", " ", x = fn)
fn <- gsub(pattern = " HA ", " ", x = fn)
fn <- gsub(pattern = "D1D6", "FANCJ-/-", x = fn)
fn <- gsub(pattern = "P2D2", "DHX36-/-", x = fn)
fn <- gsub(pattern = "P3D4", "FANCJ-/-DHX36-/-", x = fn)
return(fn)
}
BWs <- paste0(bw_dir,list.files(bw_dir,pattern="G4_.+_combined.bw"))
mypal <-c("cornflowerblue","orange","red2","#505050")
mypal3 <-c("cornflowerblue","cornflowerblue","cornflowerblue","orange","orange","orange","red2","red","red2","black","black","black")
mypal2 <-c("cornflowerblue","cornflowerblue","orange","orange","red2","red","black","black")
mypal <-c("cornflowerblue","orange","red2","#505050")
mypal3 <-c("cornflowerblue","cornflowerblue","cornflowerblue","orange","orange","orange","red2","red","red2","black","black","black")
mypal2 <-c("cornflowerblue","cornflowerblue","orange","orange","red2","red","black","black")
BWs
BWs <- paste0(bw_dir,list.files(bw_dir,pattern="G4_[DPW].+_combined.bw"))
BWs <- paste0(bw_dir,list.files(bw_dir,pattern="G4_CnT_[DPW].+_combined.bw"))
mypal <-c("cornflowerblue","orange","red2","#505050")
mypal3 <-c("cornflowerblue","cornflowerblue","cornflowerblue","orange","orange","orange","red2","red","red2","black","black","black")
mypal2 <-c("cornflowerblue","cornflowerblue","orange","orange","red2","red","black","black")
BWs <- paste0(bw_dir,list.files(bw_dir,pattern="G4_CnT_[DPW].+_combined.bw"))
pks <- rtracklayer::import("../peaks/G4_CnT_combined_peaks_DESeq_sig_categories.bed")
table(pks$name)
pks <- rtracklayer::import("../peaks/G4_CnT_combined_peaks_DJ_nonDJ.bed")
table(pks$name)
pks <- rtracklayer::import("../peaks/G4_CnT_combined_peaks_DESeq_sig_categories.bed")
DJ <- rtracklayer::import("../peaks/G4_CnT_combined_peaks_DJ_nonDJ.bed")
pks
table(pks$name)
table(pks$name, DJ$name)
DJ <- rtracklayer::import("../peaks/G4_CnT_combined_peaks_DJ_nonDJ.bed")
table(pks$name, DJ$name)
DJ$name
DJ_anno <- bedscout::annotate_overlapping_features(DJ,feat_gr = pks,name_field = "name")
table(DJ_anno$name,DJ_anno$nearby_features)
pks_DJ <- bedscout::annotate_overlapping_features(pks,feat_gr = DJ,name_field = "name")
table(pks_DJ$name,pks_DJ$nearby_features)
pks_DJ$nearby_features[is.na(pks_DJ$nearby_features)] <- ""
table(pks_DJ$name,pks_DJ$nearby_features)
table(pks_DJ$name)
table(pks_DJ$name,pks_DJ$nearby_features)
clean(BWs)
df <- as.data.frame(bw_loci(BWs,pks_DJ))
?ggbiplot
clean(colnames)
clean(colnames(df))
clean <- function (fn) {
fn <- gsub(pattern = ".+/", "", x = fn)
fn <- gsub(pattern = ".mm9.+", "", x = fn)
fn <- gsub(pattern = ".mm39.+", "", x = fn)
fn <- gsub(pattern = "_S.+", "", x = fn)
fn <- gsub(pattern = "_combined.+", "", x = fn)
fn <- gsub(pattern = "G4_CnT_", "", x = fn)
fn <- gsub(pattern = "_batch2", "", x = fn)
fn <- gsub(pattern = "-", " ", x = fn)
fn <- gsub(pattern = "_", " ", x = fn)
fn <- gsub(pattern = " HA ", " ", x = fn)
fn <- gsub(pattern = "D1D6", "FANCJ-/-", x = fn)
fn <- gsub(pattern = "P2D2", "DHX36-/-", x = fn)
fn <- gsub(pattern = "P3D4", "FANCJ-/-DHX36-/-", x = fn)
return(fn)
}
clean <- function (fn) {
clean(colnames(df))
clean <- function (fn) {
fn <- gsub(pattern = ".+/", "", x = fn)
fn <- gsub(pattern = ".mm9.+", "", x = fn)
fn <- gsub(pattern = ".mm39.+", "", x = fn)
fn <- gsub(pattern = "_S.+", "", x = fn)
fn <- gsub(pattern = "_combined", "", x = fn)
fn <- gsub(pattern = "G4_CnT_", "", x = fn)
fn <- gsub(pattern = "_batch2", "", x = fn)
fn <- gsub(pattern = "-", "", x = fn)
fn <- gsub(pattern = "_", "", x = fn)
fn <- gsub(pattern = " HA ", " ", x = fn)
fn <- gsub(pattern = "D1D6", "FANCJ", x = fn)
fn <- gsub(pattern = "P2D2", "DHX36", x = fn)
fn <- gsub(pattern = "P3D4", "DKO", x = fn)
return(fn)
}
clean(colnames(df))
colnames(df)<-clean(colnames(df))
df$DJ <- pks_DJ$nearby_features
mdf <- melt(df[,6:11])
library(reshape2)
mdf <- melt(df[,6:11])
ggviolin(mdf,x="DJ",y="value",fill="variable")
ggviolin(mdf,x="DJ",y="value",fill="variable") + coord_cartesian(ylim=c(0,100))
ggviolin(mdf,x="DJ",y="value",fill="variable") + coord_cartesian(ylim=c(0,100))
ggviolin(mdf,x="DJ",y="value",fill="variable",add="mean_sd") + coord_cartesian(ylim=c(0,100))
ggviolin(mdf,x="name",y="value",fill="variable",add="mean_sd") + coord_cartesian(ylim=c(0,100))
ggviolin(mdf,x="name",y="value",fill="variable",add="median") + coord_cartesian(ylim=c(0,100))
ggscatter(df,x="WT",y="DKO",fill="DJ") + coord_cartesian(xlim=c(0,100),ylim=c(0,100))
ggscatter(df,x="WT",y="DKO",color="DJ") + coord_cartesian(xlim=c(0,100),ylim=c(0,100))
ggscatter(df,x="WT",y="DKO",color="DJ", size=1) + coord_cartesian(xlim=c(0,100),ylim=c(0,100))
ggscatter(df,x="WT",y="DKO",color="DJ", size=0.2) + coord_cartesian(xlim=c(0,200),ylim=c(0,200))
ggscatter(df,x="WT",y="DKO",color="DJ", size=0.2, alpha=0.2) + coord_cartesian(xlim=c(0,200),ylim=c(0,200))
ggscatter(df,x="WT",y="DKO",color="DJ", size=0.2, alpha=0.8) + coord_cartesian(xlim=c(0,200),ylim=c(0,200))
ggscatter(df,x="WT",y="DKO",color="DJ", size=0.2, alpha=0.1) + coord_cartesian(xlim=c(0,200),ylim=c(0,200))
table(DJ$name)
DJ <- rtracklayer::import("../peaks/G4_CnT_combined_peaks_DJ_nonDJ.bed")
table(DJ$name)
library(reshape2)
df <- as.data.frame(bw_loci(BWs,DJ))
colnames(df)<-clean(colnames(df))
mdf <- melt(df[,6:11])
mdf <- melt(df[,6:10])
ggviolin(mdf,x="name",y="value",fill="variable",add="median") + coord_cartesian(ylim=c(0,100))
ggviolin(mdf,x="name",y="value",fill="variable",add="median",palette = mypal) + coord_cartesian(ylim=c(0,100))
mdf <- melt(df[,8:10])
ggviolin(mdf,x="name",y="value",fill="variable",add="median",palette = mypal) + coord_cartesian(ylim=c(0,100))
ggviolin(mdf,x="name",y="value",fill="variable",add="median",palette = mypal) + coord_cartesian(ylim=c(0,100)) + stat_compare_means()
ggviolin(mdf,x="name",y="value",fill="variable",add="median",palette = mypal) +stat_compare_means()
ggviolin(mdf,x="name",y="value",fill="variable",add="median",palette = mypal) + stat_compare_means()
ggviolin(mdf,x="variable",y="value",fill="variable",add="median",palette = mypal,facet.by = "name") + stat_compare_means()
ggviolin(mdf,x="variable",y="value",fill="variable",add="median",palette = mypal,facet.by = "name") + stat_compare_means()
DJ <- rtracklayer::import("../peaks/G4_CnT_combined_peaks_DJ_nonDJ.bed")
pks <- rtracklayer::import("../peaks/G4_CnT_combined_peaks_DESeq_sig_categories.bed")
pks_DJ <- bedscout::annotate_overlapping_features(pks,feat_gr = DJ,name_field = "name")
pks_DJ$nearby_features[is.na(pks_DJ$nearby_features)] <- ""
table(pks_DJ$name)
table(pks_DJ$name,pks_DJ$nearby_features)
library(reshape2)
df <- as.data.frame(bw_loci(BWs,pks_DJ))
df$DJ <- pks_DJ$nearby_features
colnames(df)<-clean(colnames(df))
mdf <- melt(df[,6:11])
ggviolin(mdf,x="name",y="value",fill="variable",add="median") + coord_cartesian(ylim=c(0,100))
ggviolin(mdf,x="name",y="value",fill="variable",add="median") + coord_cartesian(ylim=c(0,70))
df$lfc<- log2(df$DKO/df$WT)
mdf <- melt(df[,6:12])
mdf <- melt(df[,6:11])
ggviolin(mdf,x="name",y="value",fill="variable",add="median") + coord_cartesian(ylim=c(0,70))
ggscatter(df,x="WT",y="lfc",color="DJ", size=0.2, alpha=0.1) + coord_cartesian(xlim=c(0,200),ylim=c(0,200))
ggscatter(df,x="WT",y="lfc",color="DJ", size=0.2, alpha=0.1) + coord_cartesian(xlim=c(0,200))
mypal <-c("cornflowerblue","#505050","#505050","#505050")
df$lfc<- log2(df$DKO/df$WT)
ggscatter(df,x="WT",y="lfc",color="DJ", size=0.2, alpha=0.1) + coord_cartesian(xlim=c(0,200))
ggscatter(df,x="WT",y="lfc",color="DJ", size=0.2, alpha=0.1, palette = mypal) + coord_cartesian(xlim=c(0,200))
mypal <-c("#505050","cornflowerblue","#505050","#505050","#505050")
df$lfc<- log2(df$DKO/df$WT)
ggscatter(df,x="WT",y="lfc",color="DJ", size=0.2, alpha=0.1, palette = mypal) + coord_cartesian(xlim=c(0,200))
mypal <-c("#505050","red2","#505050","#505050","#505050")
df$lfc<- log2(df$DKO/df$WT)
ggscatter(df,x="WT",y="lfc",color="DJ", size=0.2, alpha=0.1, palette = mypal) + coord_cartesian(xlim=c(0,200))
df$DJ <- pks_DJ$nearby_features
ggscatter(df,x="WT",y="lfc",color="DJ", size=0.2, alpha=0.1, palette = mypal) + coord_cartesian(xlim=c(0,100))
ggscatter(df,x="DKO",y="lfc",color="DJ", size=0.2, alpha=0.1, palette = mypal) + coord_cartesian(xlim=c(0,100))
WT
ggscatter(df,x="WT",y="lfc",color="DJ", size=0.2, alpha=0.1, palette = mypal) + coord_cartesian(xlim=c(0,100))
ggscatter(df,x="WT",y="DKO",color="DJ", size=0.2, alpha=0.1, palette = mypal) + coord_cartesian(xlim=c(0,100))
ggscatter(df,x="WT",y="DKO",color="DJ", size=0.2, alpha=0.1, palette = mypal) + coord_cartesian(xlim=c(0,100), ylim=c(0,100))
df$lgWT <- log2(df$WT)
df$lgDKO <- log2(df$DKO)
ggscatter(df,x="lgWT",y="lgDKO",color="DJ", size=0.2, alpha=0.1, palette = mypal) + coord_cartesian(xlim=c(0,100), ylim=c(0,100))
ggscatter(df,x="lgWT",y="lgDKO",color="DJ", size=0.2, alpha=0.1, palette = mypal)
ggscatter(df,x="WT",y="DKO",color="DJ", size=0.2, alpha=0.1, palette = mypal) + coord_cartesian(xlim=c(0,100), ylim=c(0,100))
mypal <-c("#505050","red2","#505050","#505050","#505050")
df$lfc<- log2(df$DKO/df$WT)
ggscatter(df,x="WT",y="lfc",color="DJ", size=0.2, alpha=0.1, palette = mypal) + coord_cartesian(xlim=c(0,100))
ggscatter(df,x="WT",y="lfc",color="DJ", size=0.2, alpha=0.1, palette = mypal) + coord_cartesian(xlim=c(0,100),ylim=c(-5,5))
ggscatter(df,x="WT",y="lfc",color="DJ", size=0.2, alpha=0.1, palette = mypal) + coord_cartesian(xlim=c(0,100),ylim=c(-4.5,4.5))
library(effsize)
install.packages("effsize")
library("effsize")
bw_dir <- "../bigwig"
library("wigglescout")
library("ggpubr")
library("ggplot2")
library("DESeq2")
library("dplyr")
library("ggrastr")
library("effsize")
clean <- function (fn) {
fn <- gsub(pattern = ".+/", "", x = fn)
fn <- gsub(pattern = ".mm9.+", "", x = fn)
fn <- gsub(pattern = ".mm39.+", "", x = fn)
fn <- gsub(pattern = "_S.+", "", x = fn)
fn <- gsub(pattern = "_combined", "", x = fn)
fn <- gsub(pattern = "G4_CnT_", "", x = fn)
fn <- gsub(pattern = "_batch2", "", x = fn)
fn <- gsub(pattern = "-", "", x = fn)
fn <- gsub(pattern = "_", "", x = fn)
fn <- gsub(pattern = " HA ", " ", x = fn)
fn <- gsub(pattern = "D1D6", "FANCJ", x = fn)
fn <- gsub(pattern = "P2D2", "DHX36", x = fn)
fn <- gsub(pattern = "P3D4", "DKO", x = fn)
return(fn)
}
BWs <- paste0(bw_dir,list.files(bw_dir,pattern="G4_CnT_[DPW].+_combined.bw"))
mypal <-c("cornflowerblue","orange","red2","#505050")
mypal3 <-c("cornflowerblue","cornflowerblue","cornflowerblue","orange","orange","orange","red2","red","red2","black","black","black")
mypal2 <-c("cornflowerblue","cornflowerblue","orange","orange","red2","red","black","black")
DJ <- rtracklayer::import("../peaks/G4_CnT_combined_peaks_DJ_nonDJ.bed")
pks <- rtracklayer::import("../peaks/G4_CnT_combined_peaks_DESeq_sig_categories.bed")
pks_DJ <- bedscout::annotate_overlapping_features(pks,feat_gr = DJ,name_field = "name")
pks_DJ$nearby_features[is.na(pks_DJ$nearby_features)] <- ""
table(pks_DJ$name)
table(pks_DJ$name,pks_DJ$nearby_features)
library("effsize")
ggviolin(mdf,x="name",y="value",fill="variable",add="median") + coord_cartesian(ylim=c(0,70))
mdf <- melt(df[,8:11])
ggviolin(mdf,x="name",y="value",fill="variable",add="median") + coord_cartesian(ylim=c(0,70))
ggviolin(mdf,x="DJ",y="value",fill="variable",add="median") + coord_cartesian(ylim=c(0,70))
mdf[mdf$DJ==""]<-NULL
mdf<-mdf[mdf$DJ!=""]
mdf<-mdf[mdf$DJ!="",]
ggviolin(mdf,x="DJ",y="value",fill="variable",add="median") + coord_cartesian(ylim=c(0,70))
mypal <-c("red2","#505050")
ggviolin(mdf,x="DJ",y="value",fill="variable",add="median",palette = mypal) + coord_cartesian(ylim=c(0,70))
ggviolin(mdf,x="variable",y="value",fill="variable",add="median",palette = mypal,facet.by = "DJ") + coord_cartesian(ylim=c(0,70))
ggviolin(mdf,x="variable",y="value",fill="variable",add="median",palette = mypal,facet.by = "DJ") +  stat_compare_means(method = "t.test") + coord_cartesian(ylim=c(0,70))
ggviolin(mdf,x="variable",y="value",fill="variable",add="median",palette = mypal,facet.by = "DJ") +  stat_compare_means(method = "t.test")
ggviolin(mdf,x="variable",y="value",fill="variable",add="median",palette = mypal,facet.by = "DJ") +  stat_compare_means(method = "t.test",label.y = 10) + coord_cartesian(ylim=c(0,70))
ggviolin(mdf,x="variable",y="value",fill="variable",add="median",palette = mypal,facet.by = "DJ") +  stat_compare_means(method = "t.test",label.y = 60) + coord_cartesian(ylim=c(0,70))
ggviolin(mdf,x="variable",y="value",fill="variable",add="median",palette = mypal,facet.by = "DJ") +  stat_compare_means(method = "t.test",label.y = 60) + coord_cartesian(ylim=c(0,70))
p <- ggviolin(mdf,x="variable",y="value",fill="variable",add="median",palette = mypal,facet.by = "DJ") +  stat_compare_means(method = "t.test",label.y = 60) + coord_cartesian(ylim=c(0,70))
with(d, cohen.d(value,variable))
p <- ggviolin(mdf,x="variable",y="value",fill="variable",add="median",palette = mypal,facet.by = "DJ") +  stat_compare_means(method = "t.test",label.y = 60) + coord_cartesian(ylim=c(0,70))
with(d, cohen.d(value,variable))
p <- ggviolin(mdf,x="variable",y="value",fill="variable",add="median",palette = mypal) +  stat_compare_means(method = "t.test",label.y = 60) + coord_cartesian(ylim=c(0,70))
with(d, cohen.d(value,variable))
cohen.d(value,variable)
cohen.d(df$value,df$variable)
cohen.d(mdf$value,mdf$variable)
cohen.d(mdf$value,mdf$variable,paired = T)
mdf <- melt(df[df$DJ="DJ",8:11])
mdf <- melt(df[df$DJ=="DJ",8:11])
cohen.d(mdf$value,mdf$variable,paired = T)
mdf <- melt(df[df$DJ=="nonDJ",8:11])
cohen.d(mdf$value,mdf$variable)
cohen.d(mdf$value,mdf$variable,paired = T)
mdf <- melt(df[df$DJ=="nonDJ",8:11])
cohen.d(mdf$value,mdf$variable)
cohen.d(mdf$value,mdf$variable,paired = T)
mdf <- melt(df[df$DJ=="DJ",8:11])
cohen.d(mdf$value,mdf$variable,paired = T)
mdf <- melt(df[df$DJ=="DJ",8:11])
cohen.d(mdf$value,mdf$variable)
mdf <- melt(df[df$DJ=="nonDJ",8:11])
mdf <- melt(df[df$DJ=="nonDJ",8:11])
cohen.d(mdf$value,mdf$variable)
mypal <-c("#505050","red2","#505050","#505050","#505050")
df$lfc<- log2(df$DKO/df$WT)
ggscatter(df,x="WT",y="lfc",color="DJ", size=0.2, alpha=0.1, palette = mypal) + coord_cartesian(xlim=c(0,200))
ggviolin(mdf,x="variable",y="value",fill="variable",add="median",palette = mypal,facet.by = "DJ") +  stat_compare_means(method = "t.test",label.y = 60) + coord_cartesian(ylim=c(0,70))
mdf <- melt(df[,8:11])
ggviolin(mdf,x="variable",y="value",fill="variable",add="median",palette = mypal,facet.by = "DJ") +  stat_compare_means(method = "t.test",label.y = 60) + coord_cartesian(ylim=c(0,70))
mdf<-mdf[mdf$DJ!="",]
ggviolin(mdf,x="variable",y="value",fill="variable",add="median",palette = mypal,facet.by = "DJ") +  stat_compare_means(method = "t.test",label.y = 60) + coord_cartesian(ylim=c(0,70))
mdf <- melt(df[df$DJ=="DJ",8:11])
cohen.d(mdf$value,mdf$variable)
mdf <- melt(df[df$DJ=="nonDJ",8:11])
cohen.d(mdf$value,mdf$variable)
df$quantile <- quantile(df$WT)
install.packages(gtools)
install.packages("gtools")
library("gtools")
df$quantile <- quantcut(qdf$WT,5,na.rm = T)
df$quantile <- quantcut(df$WT,5,na.rm = T)
df$quantile <- quantcut(df$WT,4,na.rm = T)
ggviolin(df,x="quantile",y="lfc",color="DJ", size=0.2, alpha=0.1, palette = mypal) + coord_cartesian(xlim=c(0,200))
ggviolin(df,x="quantile",y="WT", size=0.2, alpha=0.1, palette = mypal) + coord_cartesian(xlim=c(0,200))
ggviolin(df,x="quantile",y="WT", palette = mypal)
ggviolin(df,x="quantile",y="WT", palette = mypal) + coord_cartesian(ylim=c(0,200))
ggviolin(df,x="quantile",y="WT", palette = mypal) + coord_cartesian(ylim=c(0,70))
ggviolin(df,x="quantile",y="lfc") + coord_cartesian(ylim=c(0,70))
ggviolin(df,x="quantile",y="lfc")
df$quantile <- quantcut(df$WT,10,na.rm = T)
ggviolin(df,x="quantile",y="lfc")
ggviolin(df,x="quantile",y="lfc", add=mean)
ggviolin(df,x="quantile",y="lfc", add="mean")
df$quantile <- quantcut(df$WT,5,na.rm = T)
ggviolin(df,x="quantile",y="lfc", add="median")
ggviolin(df,x="quantile",y="lfc", add="median") + coord_cartesian(ylim = -5,5)
ggviolin(df,x="quantile",y="lfc", add="median") + coord_cartesian(ylim = c(-5,5))
ggviolin(df,x="quantile",y="lfc", add="median", palette = mypal) + coord_cartesian(ylim = c(-5,5))
ggviolin(df,x="quantile",y="lfc", add="median", fill="quantile" palette = mypal) + coord_cartesian(ylim = c(-5,5))
ggviolin(df,x="quantile",y="lfc", add="median", fill="quantile", palette = mypal) + coord_cartesian(ylim = c(-5,5))
mypal <-c("red2","#505050","#505050","#505050","#505050","#505050")
df$quantile <- quantcut(df$WT,5,na.rm = T)
ggviolin(df,x="quantile",y="lfc", add="median", fill="quantile", palette = mypal) + coord_cartesian(ylim = c(-5,5))
ggviolin(df,x="quantile",y="lfc", add="median", fill="DJ", palette = mypal) + coord_cartesian(ylim = c(-5,5))
ggviolin(df,x="quantile",y="lfc", add="median", fill="quantile", palette = mypal) + coord_cartesian(ylim = c(-5,5))
table(df$quantile,df$DJ)
mypal <-c("#FF5050","#DD5050","#BB5050","#995050","#775050","#505050")
df$quantile <- quantcut(df$WT,5,na.rm = T)
ggviolin(df,x="quantile",y="lfc", add="median", fill="quantile", palette = mypal) + coord_cartesian(ylim = c(-5,5))
mypal <-c("#FF5050","#DD5050","#BB5050","#995050","#505050")
df$quantile <- quantcut(df$WT,5,na.rm = T)
ggviolin(df,x="quantile",y="lfc", add="median", fill="quantile", palette = mypal) + coord_cartesian(ylim = c(-5,5))
mypal <-c("#FF5050","#DD5050","#AA5050","#775050","#505050")
df$quantile <- quantcut(df$WT,5,na.rm = T)
ggviolin(df,x="quantile",y="lfc", add="median", fill="quantile", palette = mypal) + coord_cartesian(ylim = c(-5,5))
df$quantile <- as.numeric(quantcut(df$WT,5,na.rm = T))
ggviolin(df,x="quantile",y="lfc", add="median", fill="quantile", palette = mypal) + coord_cartesian(ylim = c(-5,5))
ggsave(last_plot,"plots/violin_G4_DKOlfc_by_WT_quantile")
ggsave(last_plot,"plots/violin_G4_DKOlfc_by_WT_quantile.pdf")
ggsave(last_plot(),"plots/violin_G4_DKOlfc_by_WT_quantile.pdf")
mypal <-c("#FF5050","#DD5050","#AA5050","#775050","#505050")
df$quantile <- as.numeric(quantcut(df$WT,5,na.rm = T))
ggviolin(df,x="quantile",y="lfc", add="median", fill="quantile", palette = mypal) + coord_cartesian(ylim = c(-5,5))
ggsave("plots/violin_G4_DKOlfc_by_WT_quantile.pdf")
table(df$quantile,df$DJ)
mdf <- melt(df[df$quantile=="1",8:11])
mdf <- melt(df[df$quantile=="1",8:11])
cohen.d(mdf$value,mdf$variable)
mdf <- melt(df[df$quantile=="5",8:11])
cohen.d(mdf$value,mdf$variable)
View(df)
ggviolin(mdf,x="variable",y="value",fill="variable",add="median",palette = mypal,facet.by = "DJ") +  stat_compare_means(label.y = 60) + coord_cartesian(ylim=c(0,70))
mdf <- melt(df[,8:11])
mdf<-mdf[mdf$DJ!="",]
ggviolin(mdf,x="variable",y="value",fill="variable",add="median",palette = mypal,facet.by = "DJ") +  stat_compare_means(method = "t.test",label.y = 60) + coord_cartesian(ylim=c(0,70))
mypal <-c("red2","#505050")
df <- as.data.frame(bw_loci(BWs,pks_DJ))
ggviolin(mdf,x="variable",y="value",fill="variable",add="median",palette = mypal,facet.by = "DJ") +  stat_compare_means(method = "t.test",label.y = 60) + coord_cartesian(ylim=c(0,70))
ggviolin(mdf,x="variable",y="value",fill="variable",add="mean",palette = mypal,facet.by = "DJ") +  stat_compare_means(method = "t.test",label.y = 60) + coord_cartesian(ylim=c(0,70))
View(pks)
ggscatter(df,x="lgWT",y="lfc",color="DJ", size=0.2, alpha=0.1, palette = mypal) + coord_cartesian(xlim=c(0,200))
ggscatter(df,x="lgWT",y="lfc",color="DJ", size=0.2, alpha=0.1, palette = mypal)
mypal <-c("#505050","red2","#505050","#505050","#505050")
df$lfc<- log2(df$DKO/df$WT)
ggscatter(df,x="lgWT",y="lfc",color="DJ", size=0.2, alpha=0.1, palette = mypal)
